load("//bazel:mongo_src_rules.bzl", "mongo_cc_library")

package(default_visibility = ["//visibility:public"])

mongo_cc_library(
    name = "libarchive",
    srcs = glob(["dist/libarchive/*.c"]),
    hdrs = glob(["dist/libarchive/*.h"]) + select({
        "//bazel/config:linux_aarch64": ["platform/build_linux_aarch64/config.h"],
        "//bazel/config:linux_x86_64": ["platform/build_linux_x86_64/config.h"],
        "//conditions:default": [],
    }),
    copts = [
        "-Wno-implicit-fallthrough",
    ] + select({
        "//bazel/config:linux_aarch64": ["-Isrc/third_party/libarchive/platform/build_linux_aarch64/"],
        "//bazel/config:linux_x86_64": ["-Isrc/third_party/libarchive/platform/build_linux_x86_64/"],
        "//conditions:default": [],
    }),
    includes = [
        "dist",
    ],
    local_defines = [
        "HAVE_CONFIG_H",
    ],
)
